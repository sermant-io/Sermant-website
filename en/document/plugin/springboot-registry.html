<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SpringBoot Registry | Sermant</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/logo.svg">
    <meta name="description" content="A Proxyless Service Mesh based on Bytecode Enhancement">
    
    <link rel="preload" href="/assets/css/0.styles.aea4a1e9.css" as="style"><link rel="preload" href="/assets/js/app.b687b1e7.js" as="script"><link rel="preload" href="/assets/js/3.06f127bc.js" as="script"><link rel="preload" href="/assets/js/1.c8bacf5b.js" as="script"><link rel="preload" href="/assets/js/58.13279f74.js" as="script"><link rel="preload" href="/assets/js/14.199c38f6.js" as="script"><link rel="prefetch" href="/assets/js/10.3c86f8c0.js"><link rel="prefetch" href="/assets/js/100.bc317380.js"><link rel="prefetch" href="/assets/js/101.0e4539ba.js"><link rel="prefetch" href="/assets/js/102.806b7670.js"><link rel="prefetch" href="/assets/js/103.6a5f9697.js"><link rel="prefetch" href="/assets/js/104.438d7d2a.js"><link rel="prefetch" href="/assets/js/105.2d9ea0d0.js"><link rel="prefetch" href="/assets/js/106.1902006d.js"><link rel="prefetch" href="/assets/js/107.3addad12.js"><link rel="prefetch" href="/assets/js/108.92961b8f.js"><link rel="prefetch" href="/assets/js/109.35499d22.js"><link rel="prefetch" href="/assets/js/11.592204d9.js"><link rel="prefetch" href="/assets/js/110.c9d54e80.js"><link rel="prefetch" href="/assets/js/111.611a7295.js"><link rel="prefetch" href="/assets/js/112.96184e46.js"><link rel="prefetch" href="/assets/js/113.d848a339.js"><link rel="prefetch" href="/assets/js/114.490e1858.js"><link rel="prefetch" href="/assets/js/115.f67522b9.js"><link rel="prefetch" href="/assets/js/116.daf5101e.js"><link rel="prefetch" href="/assets/js/117.8200e73f.js"><link rel="prefetch" href="/assets/js/12.fd6a031f.js"><link rel="prefetch" href="/assets/js/13.214eefed.js"><link rel="prefetch" href="/assets/js/15.900a8374.js"><link rel="prefetch" href="/assets/js/16.dc00a508.js"><link rel="prefetch" href="/assets/js/17.7bb9b1f6.js"><link rel="prefetch" href="/assets/js/18.0cb1c621.js"><link rel="prefetch" href="/assets/js/19.376e980d.js"><link rel="prefetch" href="/assets/js/20.341a6ad9.js"><link rel="prefetch" href="/assets/js/21.d802b098.js"><link rel="prefetch" href="/assets/js/22.43cc7ae1.js"><link rel="prefetch" href="/assets/js/23.021ca145.js"><link rel="prefetch" href="/assets/js/24.a3349f17.js"><link rel="prefetch" href="/assets/js/25.698376aa.js"><link rel="prefetch" href="/assets/js/26.a6ac8be9.js"><link rel="prefetch" href="/assets/js/27.09e84572.js"><link rel="prefetch" href="/assets/js/28.b0950095.js"><link rel="prefetch" href="/assets/js/29.e99b36c0.js"><link rel="prefetch" href="/assets/js/30.41dc58ef.js"><link rel="prefetch" href="/assets/js/31.8a608adb.js"><link rel="prefetch" href="/assets/js/32.1e0d9710.js"><link rel="prefetch" href="/assets/js/33.a398e056.js"><link rel="prefetch" href="/assets/js/34.e19240ac.js"><link rel="prefetch" href="/assets/js/35.284e0503.js"><link rel="prefetch" href="/assets/js/36.572ec5d2.js"><link rel="prefetch" href="/assets/js/37.67ca14dd.js"><link rel="prefetch" href="/assets/js/38.00e11239.js"><link rel="prefetch" href="/assets/js/39.9bc42bf2.js"><link rel="prefetch" href="/assets/js/4.7add7152.js"><link rel="prefetch" href="/assets/js/40.bb68876d.js"><link rel="prefetch" href="/assets/js/41.5aad2ff2.js"><link rel="prefetch" href="/assets/js/42.4c8a6e50.js"><link rel="prefetch" href="/assets/js/43.71503fb0.js"><link rel="prefetch" href="/assets/js/44.a0deab68.js"><link rel="prefetch" href="/assets/js/45.5a6500b9.js"><link rel="prefetch" href="/assets/js/46.a7414b43.js"><link rel="prefetch" href="/assets/js/47.8a6f0b3e.js"><link rel="prefetch" href="/assets/js/48.aadcaaa5.js"><link rel="prefetch" href="/assets/js/49.ea40d06f.js"><link rel="prefetch" href="/assets/js/5.4a333fb7.js"><link rel="prefetch" href="/assets/js/50.1802cdf6.js"><link rel="prefetch" href="/assets/js/51.1e3e17ce.js"><link rel="prefetch" href="/assets/js/52.e1f15f21.js"><link rel="prefetch" href="/assets/js/53.1cc82a58.js"><link rel="prefetch" href="/assets/js/54.087629cc.js"><link rel="prefetch" href="/assets/js/55.49b5b95f.js"><link rel="prefetch" href="/assets/js/56.8788daf3.js"><link rel="prefetch" href="/assets/js/57.da44ebe0.js"><link rel="prefetch" href="/assets/js/59.50ea3b1d.js"><link rel="prefetch" href="/assets/js/6.72029eac.js"><link rel="prefetch" href="/assets/js/60.9d7171de.js"><link rel="prefetch" href="/assets/js/61.c2f21438.js"><link rel="prefetch" href="/assets/js/62.f73519fb.js"><link rel="prefetch" href="/assets/js/63.fc03f383.js"><link rel="prefetch" href="/assets/js/64.549ab63a.js"><link rel="prefetch" href="/assets/js/65.df4cc878.js"><link rel="prefetch" href="/assets/js/66.5f56e3b0.js"><link rel="prefetch" href="/assets/js/67.09bd6b82.js"><link rel="prefetch" href="/assets/js/68.ab61ad07.js"><link rel="prefetch" href="/assets/js/69.cb31f10a.js"><link rel="prefetch" href="/assets/js/7.698dd478.js"><link rel="prefetch" href="/assets/js/70.fa24862f.js"><link rel="prefetch" href="/assets/js/71.b4b1e637.js"><link rel="prefetch" href="/assets/js/72.5f48b837.js"><link rel="prefetch" href="/assets/js/73.fc6b7ff3.js"><link rel="prefetch" href="/assets/js/74.a93e6a08.js"><link rel="prefetch" href="/assets/js/75.56c9c2bb.js"><link rel="prefetch" href="/assets/js/76.08013959.js"><link rel="prefetch" href="/assets/js/77.c638970a.js"><link rel="prefetch" href="/assets/js/78.766969e2.js"><link rel="prefetch" href="/assets/js/79.b230fe9f.js"><link rel="prefetch" href="/assets/js/8.10750ce9.js"><link rel="prefetch" href="/assets/js/80.53d5bd76.js"><link rel="prefetch" href="/assets/js/81.48fa2a91.js"><link rel="prefetch" href="/assets/js/82.75d2df6a.js"><link rel="prefetch" href="/assets/js/83.0315f74c.js"><link rel="prefetch" href="/assets/js/84.bb56dd4f.js"><link rel="prefetch" href="/assets/js/85.82ead8ef.js"><link rel="prefetch" href="/assets/js/86.532962b5.js"><link rel="prefetch" href="/assets/js/87.2768d3cd.js"><link rel="prefetch" href="/assets/js/88.6a5e162c.js"><link rel="prefetch" href="/assets/js/89.f9a56a5b.js"><link rel="prefetch" href="/assets/js/9.7f57e4b0.js"><link rel="prefetch" href="/assets/js/90.21ae5607.js"><link rel="prefetch" href="/assets/js/91.908a15a8.js"><link rel="prefetch" href="/assets/js/92.72a99823.js"><link rel="prefetch" href="/assets/js/93.61863d0a.js"><link rel="prefetch" href="/assets/js/94.2092419b.js"><link rel="prefetch" href="/assets/js/95.9c02260b.js"><link rel="prefetch" href="/assets/js/96.f8340a8f.js"><link rel="prefetch" href="/assets/js/97.0d52a307.js"><link rel="prefetch" href="/assets/js/98.fb61bc9c.js"><link rel="prefetch" href="/assets/js/99.8e0db346.js">
    <link rel="stylesheet" href="/assets/css/0.styles.aea4a1e9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/en/" class="home-link router-link-active"><img src="/img/sermant-logo.png" alt="Sermant" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/en/document/" class="nav-link">
  Document
</a></div><div class="nav-item"><a href="/en/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="https://github.com/sermant-io/Sermant" target="_blank" class="nav-link external">
  Github
  <!----></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/document/plugin/springboot-registry.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en/document/plugin/springboot-registry.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <div class="nav-item"><!----></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/en/document/" class="nav-link">
  Document
</a></div><div class="nav-item"><a href="/en/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="https://github.com/sermant-io/Sermant" target="_blank" class="nav-link external">
  Github
  <!----></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/document/plugin/springboot-registry.html" class="nav-link">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en/document/plugin/springboot-registry.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li></ul></div></div> <div class="nav-item"><!----></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Start</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>User Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Plugin Guide</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/document/plugin/" aria-current="page" class="sidebar-link">Plugin</a></li><li><a href="/en/document/plugin/dynamic-config.html" class="sidebar-link">Dynamic Configuration</a></li><li><a href="/en/document/plugin/springboot-registry.html" aria-current="page" class="active sidebar-link">SpringBoot Registry</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en/document/plugin/springboot-registry.html#function" class="sidebar-link">Function</a></li><li class="sidebar-sub-header"><a href="/en/document/plugin/springboot-registry.html#plugin-configuration" class="sidebar-link">Plugin configuration</a></li><li class="sidebar-sub-header"><a href="/en/document/plugin/springboot-registry.html#detailed-governance-rules" class="sidebar-link">Detailed Governance Rules</a></li><li class="sidebar-sub-header"><a href="/en/document/plugin/springboot-registry.html#supported-versions-and-limitations" class="sidebar-link">Supported Versions and Limitations</a></li><li class="sidebar-sub-header"><a href="/en/document/plugin/springboot-registry.html#operation-and-result-verification" class="sidebar-link">Operation and Result Verification</a></li></ul></li><li><a href="/en/document/plugin/register-migration.html" class="sidebar-link">Service Registry</a></li><li><a href="/en/document/plugin/flowcontrol.html" class="sidebar-link">Flow Control</a></li><li><a href="/en/document/plugin/graceful.html" class="sidebar-link">Graceful Startup/Shutdown</a></li><li><a href="/en/document/plugin/removal.html" class="sidebar-link">Outlier instance removal</a></li><li><a href="/en/document/plugin/loadbalancer.html" class="sidebar-link">Load balancing</a></li><li><a href="/en/document/plugin/router.html" class="sidebar-link">Tag Router</a></li><li><a href="/en/document/plugin/monitor.html" class="sidebar-link">Monitoring</a></li><li><a href="/en/document/plugin/visibility.html" class="sidebar-link">Service visibility</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Developer Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Community Guide</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>FAQ</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="springboot-registry"><a href="#springboot-registry" class="header-anchor">#</a> SpringBoot Registry</h1> <p>This article describes how to use the <a href="https://github.com/sermant-io/Sermant/tree/develop/sermant-plugins/sermant-springboot-registry" target="_blank" rel="noopener noreferrer">SpringBoot registry plugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="function"><a href="#function" class="header-anchor">#</a> Function</h2> <p>This plugin provides service registration and discovery abilities for pure SpringBoot applications. Users can quickly access the registration center(Currently only Zookeeper is supported) without modifying code. In addition, the plugin also provides the service timeout retry ability, achieving high availability of service invocation.</p> <p>The plug-in will resolve the downstream service according to the Url called by the originating client, select the preferred instance according to the load balance, dynamically replace the Url, and complete the service call.</p> <p>Currently, URL formats are supported.：http://${domainName}/${serviceName}/${apiPath}</p> <p>Just like the URL above, <code>domainName</code> indicates the domain name, <code>serviceName</code> indicates the downstream service name, and <code>apiPath</code> indicates the downstream request interface path.</p> <h2 id="plugin-configuration"><a href="#plugin-configuration" class="header-anchor">#</a> Plugin configuration</h2> <p>SpringBoot Registry plugin requires modification of the plugin configuration file on demand, which can be found in the path <code>${path}/agent/pluginPackage/springboot-registry/config/config.yaml</code>. The configuration file for the plugin is shown below:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">sermant.springboot.registry</span><span class="token punctuation">:</span>
  <span class="token key atrule">enableRegistry</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>                 <span class="token comment"># Whether to enable the boot registration capability</span>
  <span class="token key atrule">realmName</span><span class="token punctuation">:</span> www.domain.com             <span class="token comment"># Match the domain name, the current version only takes effect for the scene where the url is http://${realmName}/serviceName/api/xx</span>
  <span class="token key atrule">enableRequestCount</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>             <span class="token comment"># Whether to enable traffic statistics. After enabling, the traffic entering the plug-in will be counted every time</span>
     
<span class="token key atrule">sermant.springboot.registry.lb</span><span class="token punctuation">:</span>     
  <span class="token key atrule">lbType</span><span class="token punctuation">:</span> RoundRobin                    <span class="token comment"># Load balancing type, currently supports round robin (RoundRobin), random (Random), response time weight (WeightedResponseTime), minimum concurrency (BestAvailable)</span>
  <span class="token key atrule">registryAddress</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">2181</span>       <span class="token comment"># Registration center address</span>
  <span class="token key atrule">instanceCacheExpireTime</span><span class="token punctuation">:</span> <span class="token number">0</span>            <span class="token comment"># Instance expiration time, in seconds, if &lt;=0, it will never expire</span>
  <span class="token key atrule">instanceRefreshInterval</span><span class="token punctuation">:</span> <span class="token number">0</span>            <span class="token comment"># Instance refresh time, in seconds, must be less than instanceCacheExpireTime</span>
  <span class="token key atrule">refreshTimerInterval</span><span class="token punctuation">:</span> <span class="token number">5</span>               <span class="token comment"># Instance timing check interval to determine whether the instance is expired, if it is greater than instanceRefreshInterval, then the value is set to instanceRefreshInterval</span>
  <span class="token key atrule">enableSocketReadTimeoutRetry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token comment"># Whether to retry for {@link java.net.SocketTimeoutException}: read timed out, enabled by default</span>
  <span class="token key atrule">enableSocketConnectTimeoutRetry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># Same as above, mainly for connect timed out, usually thrown when the connection is not upstream or downstream</span>
  <span class="token key atrule">enableTimeoutExRetry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>            <span class="token comment"># Retry scenario, for {@link java.util.concurrent.TimeoutException}, whether retry is required, enabled by default, this timeout is mostly used in asynchronous scenarios, such as Future, MinimalHttpAsyncClient</span>
</code></pre></div><p>The configuration items are described as follows:</p> <table><thead><tr><th>Parameter Key</th> <th>Description</th> <th>Default Value</th> <th>Required</th></tr></thead> <tbody><tr><td>sermant.springboot.registry.enableRegistry</td> <td>Whether to enable springboot registration capability (true/false)</td> <td>false</td> <td>Yes</td></tr> <tr><td>sermant.springboot.registry.realmName</td> <td>Matching domain name, current version only works for <strong>http://${realmName}/serviceName/api/xx</strong> scenario</td> <td>www.domain.com</td> <td>Yes</td></tr> <tr><td>sermant.springboot.registry.enableRequestCount</td> <td>Whether to enable traffic statistics. After enabling, the traffic entering the plug-in will be counted every time (true/false)</td> <td>false</td> <td>Yes</td></tr> <tr><td>sermant.springboot.registry.lb.lbType</td> <td>Load balancing type, currently supports RoundRobin, Random, WeightedResponseTime, BestAvailable</td> <td>RoundRobin</td> <td>Yes</td></tr> <tr><td>sermant.springboot.registry.lb.registryAddress</td> <td>Registration Center Address</td> <td>127.0.0.1:2181</td> <td>Yes</td></tr> <tr><td>sermant.springboot.registry.lb.instanceCacheExpireTime</td> <td>Instance expiration time, in seconds, if &lt;= 0 then never expires</td> <td>0</td> <td>Yes</td></tr> <tr><td>sermant.springboot.registry.lb.instanceRefreshInterval</td> <td>Instance refresh time, in seconds, must be less than instanceCacheExpireTime</td> <td>0</td> <td>Yes</td></tr> <tr><td>sermant.springboot.registry.lb.refreshTimerInterval</td> <td>Instance timing check interval, determine whether the instance is expired, if it is greater than instanceRefreshInterval, then the value is set to instanceRefreshInterval</td> <td>5</td> <td>Yes</td></tr> <tr><td>sermant.springboot.registry.lb.enableSocketReadTimeoutRetry</td> <td>For <strong>java.net.SocketTimeoutException: read timed out</strong> whether to retry (true/false)</td> <td>true</td> <td>Yes</td></tr> <tr><td>sermant.springboot.registry.lb.enableSocketConnectTimeoutRetry</td> <td>For <strong>java.net.SocketTimeoutException: connect timed out</strong> whether to retry (true/false)</td> <td>true</td> <td>Yes</td></tr> <tr><td>sermant.springboot.registry.lb.enableTimeoutExRetry</td> <td>For <strong>java.util.concurrent.TimeoutException</strong> whether to retry (true/false)</td> <td>true</td> <td>Yes</td></tr></tbody></table> <p>Ensure that the values of<code>realName</code> and <code>registryAddress</code> are correct. Otherwise, the plugin does not take effect.</p> <h2 id="detailed-governance-rules"><a href="#detailed-governance-rules" class="header-anchor">#</a> Detailed Governance Rules</h2> <p>The SpringBoot registration plug-in needs to judge whether it needs to proxy the request according to the specified service name, and replace the url address. Effective service need to publish whitelist based on dynamic configuration center, publishing configuration can refer to <a href="/en/document/user-guide/configuration-center.html#sermant-dynamic-configuration-center-model">Configuration Center User's Manual</a>.</p> <p>The key value is <strong>sermant.plugin.registry</strong>.</p> <p>It is recommended to configure the group to microservice level, i.e. <strong>app=${service.meta.application}&amp;environment=${service.meta.environment}&amp;service={spring.application.name}</strong>, for the configuration of service.meta.application and service.meta.environment, please refer to the <a href="/en/document/user-guide/sermant-agent.html#sermant-agent-parameter-configuration">Sermant-agent User Manual</a>, spring.application.name is the microservice name (i.e. the name of the service configured in the spring application).</p> <p>Content is the specific configuration content of the whitelist, which is detailed as follows:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">strategy</span><span class="token punctuation">:</span> all <span class="token comment"># whitelist type , all (all effective)/none (all not effective)/white (only those configured in the value value take effect)</span>
<span class="token key atrule">value</span><span class="token punctuation">:</span> service<span class="token punctuation">-</span>b<span class="token punctuation">,</span>service<span class="token punctuation">-</span>c <span class="token comment"># Whitelist service collection, only effective when strategy is configured as white, multiple service names separated by English commas</span>
</code></pre></div><blockquote><p>Note: When adding a new configuration, please remove the comment, otherwise it will cause the addition to fail.</p></blockquote> <h2 id="supported-versions-and-limitations"><a href="#supported-versions-and-limitations" class="header-anchor">#</a> Supported Versions and Limitations</h2> <p>Framework Supported:</p> <ul><li>SpringBoot 1.5.10.Release and above</li></ul> <p>Registry Center Supported:</p> <ul><li>Zookeeper 3.4.x and above</li></ul> <p>Client Supported：</p> <ul><li><p>HttpClient: 4.x</p></li> <li><p>HttpAsyncClient: 4.1.4</p></li> <li><p>OkhttpClient: 2.x, 3.x, 4.x</p></li> <li><p>Feign(springcloud-openfeign-core): 2.1.x, 3.0.x</p></li> <li><p>RestTemplate(Spring-web): 5.1.x, 5.3.x</p></li></ul> <h2 id="operation-and-result-verification"><a href="#operation-and-result-verification" class="header-anchor">#</a> Operation and Result Verification</h2> <p>The following SpringBoot scenario is an example to demonstrate how the SpringBoot project is connected to Zookeeper.</p> <h4 id="preparations"><a href="#preparations" class="header-anchor">#</a> Preparations</h4> <ul><li><p><a href="https://github.com/sermant-io/Sermant/releases" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>/Compile the sermant package</p></li> <li><p><a href="https://github.com/sermant-io/Sermant-examples/tree/main/registry-demo/springboot-registry-demo" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> springboot-registry-demo source code</p></li> <li><p><a href="https://zookeeper.apache.org/releases.html#download" target="_blank" rel="noopener noreferrer">Download<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> Zookeeper, and start</p></li></ul> <h3 id="step-1-compile-and-package-the-springboot-registry-demo-application"><a href="#step-1-compile-and-package-the-springboot-registry-demo-application" class="header-anchor">#</a> Step 1: Compile and package the springboot-registry-demo application</h3> <p>Execute the following command in the <code>${path}/Sermant-examples/registry-demo/springboot-registry-demo</code> directory:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># windows</span>
mvn clean package

<span class="token comment"># mac, linux</span>
mvn clean package
</code></pre></div><p>After successful packaging, you can get <code>service-a.jar</code> in <code>${path}/Sermant-examples/registry-demo/springboot-registry-demo/service-a/target</code> , get <code>service-b.jar</code> in <code>${path}/Sermant-examples/registry-demo/springboot-registry-demo/service-b/target</code>.</p> <blockquote><p>Note: path is the path where the springboot-registry-demo application is downloaded.</p></blockquote> <h3 id="step-2-deploy-the-applications"><a href="#step-2-deploy-the-applications" class="header-anchor">#</a> Step 2: Deploy the applications</h3> <p>(1) Start application service-a:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># windows</span>
<span class="token function">java</span> <span class="token parameter variable">-Dserver.port</span><span class="token operator">=</span><span class="token number">8989</span> <span class="token parameter variable">-Dsermant.springboot.registry.enableRegistry</span><span class="token operator">=</span>true -javaagent:<span class="token variable">${path}</span><span class="token punctuation">\</span>sermant-agent-x.x.x<span class="token punctuation">\</span>agent<span class="token punctuation">\</span>sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>default <span class="token parameter variable">-jar</span> service-a.jar

<span class="token comment"># mac, linux</span>
<span class="token function">java</span> <span class="token parameter variable">-Dserver.port</span><span class="token operator">=</span><span class="token number">8989</span> <span class="token parameter variable">-Dsermant.springboot.registry.enableRegistry</span><span class="token operator">=</span>true -javaagent:<span class="token variable">${path}</span>/sermant-agent-x.x.x/agent/sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>default <span class="token parameter variable">-jar</span> service-a.jar
</code></pre></div><p>(2) start application service-b:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># windows</span>
<span class="token function">java</span> <span class="token parameter variable">-Dserver.port</span><span class="token operator">=</span><span class="token number">9999</span> <span class="token parameter variable">-Dsermant.springboot.registry.enableRegistry</span><span class="token operator">=</span>true -javaagent:<span class="token variable">${path}</span><span class="token punctuation">\</span>sermant-agent-x.x.x<span class="token punctuation">\</span>agent<span class="token punctuation">\</span>sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>default <span class="token parameter variable">-jar</span> service-b.jar

<span class="token comment"># mac, linux</span>
<span class="token function">java</span> <span class="token parameter variable">-Dserver.port</span><span class="token operator">=</span><span class="token number">9999</span> <span class="token parameter variable">-Dsermant.springboot.registry.enableRegistry</span><span class="token operator">=</span>true -javaagent:<span class="token variable">${path}</span>/sermant-agent-x.x.x/agent/sermant-agent.jar<span class="token operator">=</span>appName<span class="token operator">=</span>default <span class="token parameter variable">-jar</span> service-b.jar
</code></pre></div><blockquote><p>Description:</p> <ul><li>where path needs to be replaced with the actual installation path of Sermant.</li> <li>x.x.x represents a Sermant version number.</li></ul></blockquote> <blockquote><p>Note: At this time, the configured domain name (www.domain.com) is not a real domain name. It can be called normally only after the white list is configured.</p></blockquote> <h3 id="step-3-configure-white-list"><a href="#step-3-configure-white-list" class="header-anchor">#</a> Step 3: Configure white list</h3> <p>Configure white list, please refer to <a href="#detailed-governance-rules">Detailed governance rules</a>.</p> <p>The key is <strong>sermant.plugin.registry</strong>, group is <strong>app=default&amp;environment=&amp;service=service-a</strong>，content is <strong>strategy: all</strong>.</p> <p>Take Zookeeper as an example, and use the command line tools provided by Zookeeper for configuration publishing.</p> <ol><li>Execute the following command in the <code>${path}/bin/</code> directory to create the node <code>/app=default&amp;environment=</code></li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># linux mac</span>
./zkCli.sh <span class="token parameter variable">-server</span> localhost:2181 create /app<span class="token operator">=</span>default<span class="token operator">&amp;</span><span class="token assign-left variable">environment</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token assign-left variable">service</span><span class="token operator">=</span>service-a

<span class="token comment"># windows</span>
zkCli.cmd <span class="token parameter variable">-server</span> localhost:2181 create /app<span class="token operator">=</span>default<span class="token operator">&amp;</span><span class="token assign-left variable">environment</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token assign-left variable">service</span><span class="token operator">=</span>service-a
</code></pre></div><blockquote><p>Note: <code>${path}</code> is the installation directory of zookeeper</p></blockquote> <ol start="2"><li>Execute the following command in the <code>${path}/bin/</code> directory to create nodes <code>/app=default&amp;environment=&amp;service=service-a/server.plugin.registry</code> and data <code>strategy: all</code>.</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># linux mac</span>
./zkCli.sh <span class="token parameter variable">-server</span> localhost:2181 create /app<span class="token operator">=</span>default<span class="token operator">&amp;</span><span class="token assign-left variable">environment</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token assign-left variable">service</span><span class="token operator">=</span>service-a/sermant.plugin.registry <span class="token string">&quot;strategy: all&quot;</span>

<span class="token comment"># windows</span>
zkCli.cmd <span class="token parameter variable">-server</span> localhost:2181 create /app<span class="token operator">=</span>default<span class="token operator">&amp;</span><span class="token assign-left variable">environment</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token assign-left variable">service</span><span class="token operator">=</span>service-a/sermant.plugin.registry <span class="token string">&quot;strategy: all&quot;</span>
</code></pre></div><h3 id="validation"><a href="#validation" class="header-anchor">#</a> Validation</h3> <p>Invoke the<code>localhost:8989/httpClientGet</code> interface to check whether the interface is successfully returned. If yes, the plugin has taken effect.</p> <p>Success Rendering:</p> <div class="el-image"><div class="el-image__placeholder"></div><!----></div> <p>Failure rendering:</p> <div class="el-image"><div class="el-image__placeholder"></div><!----></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/18/2024, 1:29:22 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/en/document/plugin/dynamic-config.html" class="prev">
        Dynamic Configuration
      </a></span> <span class="next"><a href="/en/document/plugin/register-migration.html">
        Service Registry
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.b687b1e7.js" defer></script><script src="/assets/js/3.06f127bc.js" defer></script><script src="/assets/js/1.c8bacf5b.js" defer></script><script src="/assets/js/58.13279f74.js" defer></script><script src="/assets/js/14.199c38f6.js" defer></script>
  </body>
</html>
